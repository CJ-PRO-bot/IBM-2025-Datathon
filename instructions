# Windows PowerShell / PowerShell 7
# Run these in the repo root: IBM-2025-Datathon

# (Optional) See installed Python versions (look for 3.11)
py -0p
# (Optional) If Python 3.11 isn't installed, run once:
# winget install -e --id Python.Python.3.11

Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# 1) Create and activate virtual env (Python 3.11 recommended)
py -3.11 -m venv .venv
& ".\.venv\Scripts\Activate.ps1"

# 2) Install dependencies
python -m pip install --upgrade pip
pip install -r requirements.txt

# If you're on Python 3.13 and pip failed on onnxruntime or Pillow, run this:
# pip install "onnxruntime>=1.23,<1.24" "Pillow>=11.0.0" "opencv-python-headless>=4.10.0.84" "numpy>=2.0" --upgrade

# (Optional) Quick sanity check (should print 'ok')
python -c "import onnxruntime, PIL, flask, imagehash, piexif, numpy; print('ok')"

# 3) Create .env with RELATIVE paths
# Use ONE of the options below:

# Option A — PowerShell 7+ only (has utf8NoBOM)
@'
PV_MODEL_PATH=ai/waste_v1/validity_classifier.onnx
PV_CLASS_MAP_PATH=ai/waste_v1/class_map.json
PV_MODEL_VERSION=waste_v1_onnx
PV_ACTION_CUTOFF=0.50
PV_DISABLE_DUP_PENALTY=1
PV_DUP_DISTANCE=3
'@ | Set-Content -Path .\.env -Encoding utf8NoBOM

# Option B — Windows PowerShell 5.1 compatible (preferred for compatibility)
$utf8NoBom = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText(".env", @'
PV_MODEL_PATH=ai/waste_v1/validity_classifier.onnx
PV_CLASS_MAP_PATH=ai/waste_v1/class_map.json
PV_MODEL_VERSION=waste_v1_onnx
PV_ACTION_CUTOFF=0.50
PV_DISABLE_DUP_PENALTY=1
PV_DUP_DISTANCE=3
'@, $utf8NoBom)

# Option C — ASCII also works (keys/values are plain ASCII)
@'
PV_MODEL_PATH=ai/waste_v1/validity_classifier.onnx
PV_CLASS_MAP_PATH=ai/waste_v1/class_map.json
PV_MODEL_VERSION=waste_v1_onnx
PV_ACTION_CUTOFF=0.50
PV_DISABLE_DUP_PENALTY=1
PV_DUP_DISTANCE=3
'@ | Set-Content -Path .\.env -Encoding Ascii

# 4) Ensure model artifacts exist at:
#    ai/waste_v1/validity_classifier.onnx
#    ai/waste_v1/class_map.json

# 5) Run the app (dev)
python app.py
# App starts at: http://127.0.0.1:5000

# 6) Test photos
# Use images from the `test_photos` folder in this repo to try the AI.

# 7) Demo logins (for judging only — do NOT reuse in production)
# User:  123@gmail.com / 123
# Admin: admin@example.com / admin123